<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Big Cat Taxonomy Tree</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: repeating-linear-gradient(
      45deg,
      #0a0f1c,
      #0a0f1c 20px,
      #0c1220 20px,
      #0c1220 40px
    );
    color: #e6eef6;
    overflow: hidden;
  }
  header {
    background: #0f172a;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    padding: 10px 15px;
    gap: 20px;
  }
  h1 {
    font-size: 18px;
    margin: 0;
    flex-shrink: 0;
  }
  .buttons {
    display: flex;
    gap: 8px;
  }
  button {
    background: rgba(255,255,255,0.08);
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover {
    background: rgba(255,255,255,0.15);
  }
  .legend {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-left: auto;
    font-size: 13px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .legend-color {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }
  svg {
    width: 100%;
    height: calc(100vh - 50px);
  }
  .link {
    fill: none;
    stroke-opacity: 0.6;
    stroke-width: 1.5px;
  }
  .node circle {
    cursor: pointer;
    stroke-width: 1.5px;
  }
  .tooltip {
    position: absolute;
    background: #1e293b;
    color: white;
    padding: 8px 10px;
    border-radius: 6px;
    font-size: 13px;
    max-width: 240px;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    display: none;
  }
</style>
</head>
<body>
<header>
  <h1>Big Cat Taxonomy Tree</h1>
  <div class="buttons">
    <button id="expandAll">Expand all</button>
    <button id="collapseGenera">Collapse to genera</button>
    <button id="resetView">Reset view</button>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="background:#fbbf24"></div>Family</div>
    <div class="legend-item"><div class="legend-color" style="background:#22d3ee"></div>Subfamily</div>
    <div class="legend-item"><div class="legend-color" style="background:#ef4444"></div>Panthera</div>
    <div class="legend-item"><div class="legend-color" style="background:#a855f7"></div>Neofelis</div>
    <div class="legend-item"><div class="legend-color" style="background:#3b82f6"></div>Acinonyx</div>
    <div class="legend-item"><div class="legend-color" style="background:#22c55e"></div>Puma</div>
  </div>
</header>
<svg></svg>
<div class="tooltip"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const data = {
  name: 'Felidae (Family)', color: '#fbbf24',
  children: [
    {
      name: 'Pantherinae (Subfamily)', color: '#22d3ee',
      children: [
        {
          name: 'Panthera (Genus)', color: '#ef4444',
          children: [
            { name: 'Lion (Panthera leo)', info: 'Large social cat native to Africa and India.', color: '#ef4444' },
            { name: 'Tiger (Panthera tigris)', info: 'Largest of the big cats, native to Asia.', color: '#ef4444' },
            { name: 'Jaguar (Panthera onca)', info: 'Powerful cat of the Americas, strong bite.', color: '#ef4444' },
            { name: 'Leopard (Panthera pardus)', info: 'Rosette-patterned coat, Africa and Asia.', color: '#ef4444' },
            { name: 'Snow Leopard (Panthera uncia)', info: 'High-altitude cat of Central Asia.', color: '#ef4444' }
          ]
        },
        {
          name: 'Neofelis (Genus)', color: '#a855f7',
          children: [
            { name: 'Clouded Leopard (Neofelis nebulosa)', info: 'Arboreal cat of SE Asia.', color: '#a855f7' },
            { name: 'Sunda Clouded Leopard (Neofelis diardi)', info: 'Borneo and Sumatra.', color: '#a855f7' }
          ]
        }
      ]
    },
    {
      name: 'Felinae (Subfamily)', color: '#22d3ee',
      children: [
        {
          name: 'Acinonyx (Genus)', color: '#3b82f6',
          children: [
            { name: 'Cheetah (Acinonyx jubatus)', info: 'Fastest land mammal.', color: '#3b82f6' }
          ]
        },
        {
          name: 'Puma (Genus)', color: '#22c55e',
          children: [
            { name: 'Cougar (Puma concolor)', info: 'Wide-ranging American cat.', color: '#22c55e' }
          ]
        }
      ]
    }
  ]
};

// collapse to genera
function collapseToGenera(d) {
  if (d.children) {
    d.children.forEach(c => {
      if (c.children && c.children[0].children === undefined) {
        // genus level, keep expanded
      } else {
        collapse(c);
      }
    });
  }
}
function collapse(d) {
  if (d.children) {
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}
function expand(d) {
  if (d._children) {
    d.children = d._children;
    d._children = null;
  }
  if (d.children) d.children.forEach(expand);
}

const svg = d3.select("svg"),
      width = window.innerWidth,
      height = window.innerHeight - 50;

const g = svg.append("g").attr("transform", "translate(80,50)");

const tree = d3.tree().size([height - 100, width - 250]);
let root = d3.hierarchy(data);
root.x0 = height / 2;
root.y0 = 0;

collapseToGenera(root);

const tooltip = d3.select(".tooltip");

function update(source) {
  const duration = 400;
  const nodes = root.descendants();
  const links = root.links();

  tree(root);

  let node = g.selectAll('g.node').data(nodes, d => d.id || (d.id = ++i));

  let nodeEnter = node.enter().append('g')
    .attr('class', 'node')
    .attr('transform', d => `translate(${source.y0},${source.x0})`)
    .on('click', (event,d) => {
      if (d.children) { d._children = d.children; d.children = null; }
      else { d.children = d._children; d._children = null; }
      update(d);
    })
    .on('mouseover', (event,d) => {
      if (d.data.info) {
        tooltip.style('display','block')
               .html(`<strong>${d.data.name}</strong><br>${d.data.info}`);
      }
    })
    .on('mousemove', event => {
      tooltip.style('left', (event.pageX+10)+'px')
             .style('top', (event.pageY+10)+'px');
    })
    .on('mouseout', () => tooltip.style('display','none'));

  nodeEnter.append('circle')
    .attr('r', 1e-6)
    .attr('fill', d => d._children ? d.data.color : d.data.color)
    .attr('stroke', '#0f172a');

  nodeEnter.append('text')
    .attr('dy', 4)
    .attr('x', d => d.children || d._children ? -12 : 12)
    .attr('text-anchor', d => d.children || d._children ? 'end' : 'start')
    .text(d => d.data.name)
    .style('fill-opacity', 1e-6);

  let nodeUpdate = nodeEnter.merge(node);

  nodeUpdate.transition().duration(duration)
    .attr('transform', d => `translate(${d.y},${d.x})`);

  nodeUpdate.select('circle')
    .attr('r', 6)
    .attr('fill', d => d.data.color);

  nodeUpdate.select('text').style('fill-opacity', 1);

  let nodeExit = node.exit().transition().duration(duration)
    .attr('transform', d => `translate(${source.y},${source.x})`)
    .remove();

  nodeExit.select('circle').attr('r', 1e-6);
  nodeExit.select('text').style('fill-opacity', 1e-6);

  let link = g.selectAll('path.link').data(links, d => d.target.id);

  link.enter().insert('path', 'g')
    .attr('class', 'link')
    .attr('stroke', '#94a3b8')
    .attr('d', d => {
      const o = {x: source.x0, y: source.y0};
      return diagonal({source: o, target: o});
    })
    .merge(link)
    .transition().duration(duration)
    .attr('d', diagonal);

  link.exit().transition().duration(duration)
    .attr('d', d => {
      const o = {x: source.x, y: source.y};
      return diagonal({source: o, target: o});
    })
    .remove();

  nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
}

function diagonal(d) {
  return `M${d.source.y},${d.source.x}
          C${(d.source.y + d.target.y) / 2},${d.source.x}
           ${(d.source.y + d.target.y) / 2},${d.target.x}
           ${d.target.y},${d.target.x}`;
}

let i = 0;
update(root);

document.getElementById('expandAll').onclick = () => { expand(root); update(root); };
document.getElementById('collapseGenera').onclick = () => { collapseToGenera(root); update(root); };
document.getElementById('resetView').onclick = () => {
  svg.transition().duration(400).call(
    d3.zoom().transform,
    d3.zoomIdentity
  );
};

</script>
</body>
</html>
