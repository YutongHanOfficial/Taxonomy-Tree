<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Big Cat Taxonomy Tree Visualizer</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ff6b6b;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071028 0%,#071020 60%);color:#e6eef6}
    .app{display:flex;flex-direction:column;height:100vh}
    header{display:flex;gap:12px;align-items:center;padding:14px;border-bottom:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(6px)}
    h1{font-size:18px;margin:0}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .control{background:var(--glass);padding:8px;border-radius:10px;font-size:13px;display:flex;gap:6px;align-items:center}
    input[type="text"]{background:transparent;border:0;outline:0;color:inherit;width:200px}
    button{background:linear-gradient(90deg,var(--accent),#ffa94d);border:0;padding:8px 10px;border-radius:8px;color:#071028;font-weight:600;cursor:pointer}
    main{flex:1;display:flex;overflow:hidden}
    #canvas{flex:1}
    .sidebar{width:320px;background:rgba(255,255,255,0.02);padding:14px;border-left:1px solid rgba(255,255,255,0.03);box-shadow:inset 0 0 0 1px rgba(255,255,255,0.01)}
    .legend h3{margin:8px 0 6px 0;font-size:14px}
    .node-label{font-size:12px}
    .tooltip{position:absolute;pointer-events:none;background:#07122a;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;box-shadow:0 6px 20px rgba(2,6,23,0.7);max-width:260px}
    .credits{font-size:12px;color:var(--muted);margin-top:12px}
    a.copylink{color:var(--accent);text-decoration:none}
    footer{padding:8px 14px;font-size:12px;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Big Cat Taxonomy Tree — Family → Genus → Species</h1>
      <div class="controls">
        <div class="control">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5"/></svg>
          <input id="search" type="text" placeholder="Search species or genus (e.g. Panthera leo)" />
          <button id="searchBtn">Find</button>
        </div>
        <div class="control">
          <label style="font-size:12px;opacity:.9;margin-right:6px">Layout</label>
          <select id="layoutSelect" style="background:transparent;border:0;color:inherit">
            <option value="vertical">Vertical</option>
            <option value="radial">Radial</option>
          </select>
        </div>
        <div class="control"><button id="resetBtn">Reset</button></div>
      </div>
    </header>

    <main>
      <div id="canvas"></div>
      <aside class="sidebar">
        <div class="legend">
          <h3>Instructions</h3>
          <ol style="padding-left:16px;margin:6px 0 12px 0;color:var(--muted)">
            <li>Click a node to expand/collapse.</li>
            <li>Hover a species node to see a short description.</li>
            <li>Use the search box to highlight a node.</li>
            <li>Pan & zoom with mouse/touch gestures.</li>
          </ol>
          <h3>Included Taxa</h3>
          <div style="color:var(--muted);font-size:13px">Family: <strong>Felidae</strong><br/>Subfamilies: <em>Pantherinae</em>, <em>Felinae</em><br/>Genera (selected): <strong>Panthera</strong>, <strong>Neofelis</strong>, <strong>Acinonyx</strong>, <strong>Puma</strong></div>
          <p class="credits">Data: simplified for visualization purposes — common classifications only.</p>
        </div>
        <div style="margin-top:12px">
          <h3>About</h3>
          <div style="color:var(--muted);font-size:13px">This interactive visualizer shows a simplified evolutionary lineage for big-cat species commonly called "big cats". It is designed for educational visualization, not as a taxonomic authority.</div>
        </div>
      </aside>
    </main>

    <footer>Tip: open this file in a browser or host on GitHub Pages. Zoom with mouse wheel, drag to pan.</footer>
  </div>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  // Hierarchical data (Family -> Subfamily -> Genus -> Species)
  const treeData = {
    name: 'Felidae (Family)',
    children: [
      {
        name: 'Pantherinae (Subfamily)',
        children: [
          {
            name: 'Panthera (Genus)',
            children: [
              { name: 'Panthera leo', common: 'Lion', info: 'Large social cat native to Africa and India; lives in prides; apex predator in many ecosystems.' },
              { name: 'Panthera tigris', common: 'Tiger', info: 'Largest of the big cats; solitary ambush predator native to Asia; strongly marked with stripes.' },
              { name: 'Panthera onca', common: 'Jaguar', info: 'Powerful feline of the Americas; noted for strong bite force and often found near water.' },
              { name: 'Panthera pardus', common: 'Leopard', info: 'Adaptable solitary cat with rosette-patterned coat; wide distribution in Africa and Asia.' },
              { name: 'Panthera uncia', common: 'Snow Leopard', info: 'High-altitude specialist of Central Asia with thick fur and long tail for balance.' }
            ]
          },
          {
            name: 'Neofelis (Genus)',
            children: [
              { name: 'Neofelis nebulosa', common: 'Clouded Leopard', info: 'Medium-sized felid of Southeast Asia; arboreal with long tail and cloud-like spots.' },
              { name: 'Neofelis diardi', common: 'Sunda Clouded Leopard', info: 'Island relative of N. nebulosa found in Borneo and Sumatra; recently split as separate species.' }
            ]
          }
        ]
      },
      {
        name: 'Felinae (Subfamily)',
        children: [
          {
            name: 'Acinonyx (Genus)',
            children: [
              { name: 'Acinonyx jubatus', common: 'Cheetah', info: 'Built for speed — fastest land mammal; semi-retractable claws and long limbs for sprinting.' }
            ]
          },
          {
            name: 'Puma (Genus)',
            children: [
              { name: 'Puma concolor', common: 'Cougar / Mountain Lion', info: 'Wide-ranging American felid with many regional names; solitary and adaptable.' }
            ]
          }
        ]
      }
    ]
  };

  // Basic setup
  const width = document.documentElement.clientWidth - 320; // leave sidebar
  const height = document.documentElement.clientHeight - 120;

  const svg = d3.select('#canvas').append('svg')
    .attr('width', width)
    .attr('height', height)
    .style('cursor','grab')
    .call(d3.zoom().scaleExtent([0.5, 3]).on('zoom', (event) => { g.attr('transform', event.transform); }))
    .on('wheel.zoom', null); // We'll allow wheel via default zoom on container instead

  const g = svg.append('g').attr('transform', `translate(${80},20)`);

  let root = d3.hierarchy(treeData);
  root.x0 = height / 2;
  root.y0 = 0;

  // Collapse all but first level
  root.children.forEach(collapse);

  // Tooltip
  const tooltip = d3.select('body').append('div').attr('class','tooltip').style('display','none');

  // Layout choice
  const layoutSelect = document.getElementById('layoutSelect');
  layoutSelect.addEventListener('change', () => update(root));

  document.getElementById('resetBtn').addEventListener('click', () => {
    // reset zoom and expand all
    svg.transition().duration(300).call(d3.zoom().transform, d3.zoomIdentity);
    expandAll(root);
    update(root);
  });

  document.getElementById('searchBtn').addEventListener('click', () => {
    const q = document.getElementById('search').value.trim().toLowerCase();
    if(!q) return;
    const match = root.descendants().find(d => d.data.name.toLowerCase() === q || ((d.data.common||'').toLowerCase() === q));
    if(match){
      // expand path
      let cur = match;
      while(cur.parent){ cur.parent._children ? (cur.parent.children = cur.parent._children, cur.parent._children = null) : null; cur = cur.parent; }
      update(root);
      // center on node
      const transform = d3.zoomTransform(svg.node());
      const nx = match.x; const ny = match.y;
      svg.transition().duration(600).call(d3.zoom().transform, d3.zoomIdentity.translate(width/2 - ny, height/2 - nx).scale(transform.k));
      highlightNode(match);
    } else {
      alert('No exact match found. Try a genus (Panthera) or full species name (Panthera leo)');
    }
  });

  function highlightNode(d){
    // briefly pulse
    d3.selectAll('circle').attr('stroke-width',1);
    const sel = d3.selectAll('g.node').filter(n=>n===d).select('circle');
    sel.transition().duration(150).attr('stroke-width',4).transition().duration(500).attr('stroke-width',1);
  }

  update(root);

  // -- core update() adapted for vertical and radial layouts
  function update(source){
    const layout = layoutSelect.value;
    if(layout === 'radial'){
      const tree = d3.tree().size([2 * Math.PI, Math.min(width, height) / 2 - 100]);
      tree(root);
      // convert to radial coordinates
      const nodes = root.descendants();

      const links = root.links();

      // draw links
      const link = g.selectAll('path.link').data(links, d=>d.target.data.name);
      link.enter().append('path').attr('class','link').merge(link)
        .attr('fill','none').attr('stroke','rgba(255,255,255,0.06)').attr('stroke-width',1.2)
        .attr('d', d => {
          const s = project(d.source.x,d.source.y);
          const t = project(d.target.x,d.target.y);
          return `M${s.y},${s.x}C${(s.y+t.y)/2},${s.x} ${(s.y+t.y)/2},${t.x} ${t.y},${t.x}`;
        });
      link.exit().remove();

      // nodes
      const node = g.selectAll('g.node').data(nodes, d=>d.data.name);
      const nodeEnter = node.enter().append('g').attr('class','node').on('click', (event,d)=>{ toggle(d); update(d); });
      nodeEnter.append('circle').attr('r',6).attr('fill',d=>d.children||d._children? '#ffb4a2' : '#ffd6a5').attr('stroke','#111827');
      nodeEnter.append('text').attr('dy',-10).attr('x',d=>d.x<Math.PI===!d.children?10:-10).attr('text-anchor','middle').text(d=>d.data.name).style('font-size','11px');
      nodeEnter.merge(node).attr('transform', d => {
        const p = project(d.x,d.y);
        return `translate(${p.y},${p.x})`;
      });

      nodeEnter.on('mouseover', (event,d)=> showTooltip(event,d)).on('mousemove', (event)=> moveTooltip(event)).on('mouseout', hideTooltip);

      node.exit().remove();

    } else { // vertical
      const tree = d3.tree().size([height - 160, width - 400]);
      tree(root);
      const nodes = root.descendants();
      const links = root.links();

      // links
      const link = g.selectAll('path.link').data(links, d=>d.target.data.name);
      link.enter().append('path').attr('class','link').merge(link)
        .attr('fill','none').attr('stroke','rgba(255,255,255,0.06)').attr('stroke-width',1.2)
        .attr('d', d => `M${d.source.y},${d.source.x}C${(d.source.y + d.target.y)/2},${d.source.x} ${(d.source.y + d.target.y)/2},${d.target.x} ${d.target.y},${d.target.x}`);
      link.exit().remove();

      // nodes
      const node = g.selectAll('g.node').data(nodes, d=>d.data.name);
      const nodeEnter = node.enter().append('g').attr('class','node').attr('transform', d=> `translate(${d.source ? d.source.y : d.y},${d.source ? d.source.x : d.x})`).on('click', (event,d)=>{ toggle(d); update(d); });

      nodeEnter.append('circle').attr('r',6).attr('fill',d=>d.children||d._children? '#ffd6a5' : '#ffe8cc').attr('stroke','#061425');

      nodeEnter.append('text').attr('dy',3).attr('x', d=> d.children||d._children ? -12 : 12).attr('text-anchor', d=> d.children||d._children ? 'end' : 'start').text(d=>d.data.name).style('font-size','12px');

      // merge + transition
      const nodeUpdate = nodeEnter.merge(node);
      nodeUpdate.transition().duration(300).attr('transform', d=> `translate(${d.y},${d.x})`);

      nodeUpdate.select('circle').attr('r',8);

      nodeUpdate.on('mouseover', (event,d)=> showTooltip(event,d)).on('mousemove', (event)=> moveTooltip(event)).on('mouseout', hideTooltip);

      node.exit().remove();
    }
  }

  function project(x,y){
    // radial projection (x angle, y radius)
    return {x: (x - Math.PI/2), y: y};
  }

  function showTooltip(event,d){
    if(d.data.info){
      tooltip.style('display','block').html(`<strong>${d.data.name}</strong><div style="font-size:12px;color:#cbd5e1;margin-top:6px">${d.data.common ? '<em>'+d.data.common+'</em><br/>' : ''}${d.data.info}</div>`);
    } else {
      tooltip.style('display','block').html(`<strong>${d.data.name}</strong>`);
    }
    moveTooltip(event);
  }
  function moveTooltip(event){
    tooltip.style('left', (event.pageX + 12) + 'px').style('top', (event.pageY + 12) + 'px');
  }
  function hideTooltip(){ tooltip.style('display','none'); }

  function toggle(d){ if(d.children){ d._children = d.children; d.children = null; } else { d.children = d._children; d._children = null; } }
  function collapse(d){ if(d.children){ d.children.forEach(collapse); d._children = d.children; d.children = null; } }
  function expandAll(d){ if(d._children){ d.children = d._children; d._children = null; } if(d.children) d.children.forEach(expandAll); }

  // Responsive resize
  window.addEventListener('resize', ()=> location.reload());

  </script>
</body>
</html>
