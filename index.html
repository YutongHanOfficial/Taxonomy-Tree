<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Big Cat Taxonomy Tree</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: repeating-linear-gradient(45deg, #0e1a26, #0e1a26 20px, #142433 20px, #142433 40px);
    color: #fff;
    overflow: hidden;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
  }
  header h1 {
    font-size: 1.4rem;
    font-weight: 700;
  }
  .controls button {
    background: #1f3b52;
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    margin-left: 0.5rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .controls button:hover {
    background: #28506e;
  }
  .legend {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.85rem;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }
  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }
  .tooltip {
    position: absolute;
    background: rgba(20, 30, 40, 0.95);
    padding: 0.8rem;
    border-radius: 8px;
    max-width: 260px;
    pointer-events: none;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    font-size: 0.85rem;
    line-height: 1.4;
    opacity: 0;
    transition: opacity 0.2s;
    color: white;
  }
  .tooltip h2 {
    font-size: 1rem;
    margin: 0;
    font-weight: 700;
  }
  .tooltip em {
    font-style: italic;
    font-size: 0.85rem;
    display: block;
    margin-top: 0.1rem;
    color: #cfd9e3;
  }
  .tooltip .meta {
    font-size: 0.75rem;
    color: #a0b2c2;
    margin-top: 0.2rem;
  }
</style>
</head>
<body>
<header>
  <h1>Big Cat Taxonomy Tree</h1>
  <div class="controls">
    <button id="expandAll">Expand all</button>
    <button id="collapseGenera">Collapse to genera</button>
    <button id="resetView">Reset view</button>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="background:#ff4b4b"></div>Panthera</div>
    <div class="legend-item"><div class="legend-color" style="background:#b16dff"></div>Neofelis</div>
    <div class="legend-item"><div class="legend-color" style="background:#4bb6ff"></div>Acinonyx</div>
    <div class="legend-item"><div class="legend-color" style="background:#4bff88"></div>Puma</div>
  </div>
</header>
<svg id="tree"></svg>
<div class="tooltip" id="tooltip"></div>
<script>
const data = {
  name: "Felidae",
  rank: "Family",
  description: "The biological family of cats; carnivorous mammals known for their agility and predatory skills.",
  children: [
    {
      name: "Pantherinae",
      rank: "Subfamily",
      children: [
        {
          name: "Panthera",
          rank: "Genus",
          color: "#ff4b4b",
          children: [
            { name: "Lion", sci: "Panthera leo", rank: "Species", description: "Social big cat living in prides; apex predator of African savannas and India's Gir Forest.", color: "#ff4b4b" },
            { name: "Tiger", sci: "Panthera tigris", rank: "Species", description: "Largest cat species; solitary hunter of Asia's forests and grasslands.", color: "#ff4b4b" },
            { name: "Jaguar", sci: "Panthera onca", rank: "Species", description: "Powerful swimmer and apex predator of Central and South America's forests.", color: "#ff4b4b" },
            { name: "Leopard", sci: "Panthera pardus", rank: "Species", description: "Stealthy and adaptable predator found across Africa and Asia.", color: "#ff4b4b" },
            { name: "Snow Leopard", sci: "Panthera uncia", rank: "Species", description: "Elusive big cat of Central and South Asia's mountains.", color: "#ff4b4b" }
          ]
        },
        {
          name: "Neofelis",
          rank: "Genus",
          color: "#b16dff",
          children: [
            { name: "Clouded Leopard", sci: "Neofelis nebulosa", rank: "Species", description: "Arboreal predator of Southeast Asian forests.", color: "#b16dff" },
            { name: "Sunda Clouded Leopard", sci: "Neofelis diardi", rank: "Species", description: "Rare forest cat native to Borneo and Sumatra.", color: "#b16dff" }
          ]
        }
      ]
    },
    {
      name: "Felinae",
      rank: "Subfamily",
      children: [
        {
          name: "Acinonyx",
          rank: "Genus",
          color: "#4bb6ff",
          children: [
            { name: "Cheetah", sci: "Acinonyx jubatus", rank: "Species", description: "Fastest land animal; inhabits African savannas.", color: "#4bb6ff" }
          ]
        },
        {
          name: "Puma",
          rank: "Genus",
          color: "#4bff88",
          children: [
            { name: "Cougar", sci: "Puma concolor", rank: "Species", description: "Large solitary cat of the Americas, also called mountain lion or puma.", color: "#4bff88" }
          ]
        }
      ]
    }
  ]
};

const svg = d3.select("#tree");
const width = window.innerWidth;
const height = window.innerHeight - document.querySelector("header").offsetHeight;
svg.attr("width", width).attr("height", height);
const g = svg.append("g").attr("transform", "translate(80,40)");
const tooltip = d3.select("#tooltip");

const treeLayout = d3.tree().size([height - 100, width - 300]);
let root = d3.hierarchy(data);
root.x0 = height / 2;
root.y0 = 0;
root.children.forEach(collapse);

const zoom = d3.zoom().scaleExtent([0.5, 2]).on("zoom", (event) => {
  g.attr("transform", event.transform);
});
svg.call(zoom);

update(root);

function update(source) {
  const treeData = treeLayout(root);
  const nodes = treeData.descendants();
  const links = treeData.links();
  
  nodes.forEach(d => { d.y = d.depth * 180; });
  
  const node = g.selectAll("g.node").data(nodes, d => d.id || (d.id = ++i));
  
  const nodeEnter = node.enter().append("g")
    .attr("class", "node")
    .attr("transform", d => `translate(${source.y0},${source.x0})`)
    .on("click", (event, d) => {
      if (d.children) { d._children = d.children; d.children = null; }
      else { d.children = d._children; d._children = null; }
      update(d);
    })
    .on("mouseover", (event, d) => {
      if (!d.data.sci && !d.data.description) return;
      tooltip.style("opacity", 1)
        .html(`
          <h2>${d.data.name}</h2>
          ${d.data.sci ? `<em>${d.data.sci}</em>` : ""}
          <div class="meta">Rank: ${d.data.rank}${d.parent ? ` Â· Genus: ${getGenus(d)}` : ""}</div>
          <div>${d.data.description || ""}</div>
        `)
        .style("left", (event.pageX + 15) + "px")
        .style("top", (event.pageY + 15) + "px");
    })
    .on("mousemove", (event) => {
      tooltip.style("left", (event.pageX + 15) + "px")
             .style("top", (event.pageY + 15) + "px");
    })
    .on("mouseout", () => tooltip.style("opacity", 0));
  
  nodeEnter.append("circle")
    .attr("r", 1e-6)
    .style("fill", d => d.data.color || "#ffb347")
    .style("stroke", "#fff")
    .style("stroke-width", "1.5px");
  
  nodeEnter.append("text")
    .attr("dy", ".35em")
    .attr("x", d => d.children || d._children ? -15 : 15)
    .attr("text-anchor", d => d.children || d._children ? "end" : "start")
    .text(d => d.data.name)
    .style("fill", "#fff")
    .style("font-size", "0.85rem");
  
  const nodeUpdate = nodeEnter.merge(node);
  nodeUpdate.transition().duration(500)
    .attr("transform", d => `translate(${d.y},${d.x})`);
  nodeUpdate.select("circle").attr("r", 8);
  
  const nodeExit = node.exit().transition().duration(500)
    .attr("transform", d => `translate(${source.y},${source.x})`)
    .remove();
  nodeExit.select("circle").attr("r", 1e-6);
  
  const link = g.selectAll("path.link").data(links, d => d.target.id);
  const linkEnter = link.enter().insert("path", "g")
    .attr("class", "link")
    .attr("d", d => {
      const o = {x: source.x0, y: source.y0};
      return diagonal(o, o);
    })
    .style("fill", "none")
    .style("stroke", "#ccc")
    .style("stroke-width", "1.5px");
  
  linkEnter.merge(link).transition().duration(500)
    .attr("d", d => diagonal(d.source, d.target));
  
  link.exit().transition().duration(500)
    .attr("d", d => {
      const o = {x: source.x, y: source.y};
      return diagonal(o, o);
    }).remove();
  
  nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
}

function diagonal(s, d) {
  return `M ${s.y} ${s.x}
          C ${(s.y + d.y) / 2} ${s.x},
            ${(s.y + d.y) / 2} ${d.x},
            ${d.y} ${d.x}`;
}

function collapse(d) {
  if (d.children) {
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

function expand(d) {
  if (d._children) {
    d.children = d._children;
    d.children.forEach(expand);
    d._children = null;
  }
}

function getGenus(d) {
  let node = d;
  while (node.parent) {
    if (node.parent.data.rank === "Genus") return node.parent.data.name;
    node = node.parent;
  }
  return "";
}

let i = 0;

document.getElementById("expandAll").onclick = () => { root.children.forEach(expand); update(root); };
document.getElementById("collapseGenera").onclick = () => { root.children.forEach(collapse); update(root); };
document.getElementById("resetView").onclick = () => {
  svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
};
</script>
</body>
</html>
